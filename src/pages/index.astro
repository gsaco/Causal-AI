---
import BaseLayout from "@layouts/BaseLayout.astro";
import PaperCard from "@components/PaperCard.astro";
import ProvenancePanel from "@components/ProvenancePanel.astro";
import CoverageBadge from "@components/CoverageBadge.astro";
import { readJson } from "@utils/data";
import { withBase } from "@utils/withBase";

const papers = await readJson("papers.index.json");
const topics = await readJson("taxonomy/topics.json");
const build = await readJson("provenance/build.json");
const momentum = await readJson("metrics/topic_momentum.json");
const coverage = await readJson("metrics/citation_coverage.json");
const windowA = momentum.window.A.replace("_to_", " to ");
const windowB = momentum.window.B.replace("_to_", " to ");

const trending = [...papers]
  .sort((a, b) => (b.metrics.trending_score ?? 0) - (a.metrics.trending_score ?? 0))
  .slice(0, 3);
---
<BaseLayout wide title="Causal-AI - Researcher-grade causal AI intelligence">
  <section class="hero section">
    <div class="container hero-grid">
      <div class="fade-in">
        <p class="chip">Snapshot {build.snapshot}</p>
        <h1>Causal AI intelligence for teams that need evidence, not vibes.</h1>
        <p class="subtitle">
          We curate causal AI signals, not just papers - linking every claim to arXiv IDs, tracking
          update cadence, and surfacing momentum across the field.
        </p>
        <div class="hero-actions">
          <a class="button" href={withBase("/observatory")}>Enter Observatory</a>
          <a class="button secondary" href={withBase("/trends")}>Read trends</a>
        </div>
        <div class="manifesto">
          <div class="manifesto-card">
            <h3>Evidence first</h3>
            <p class="subtle">Every claim is tied to arXiv metadata and validated in CI.</p>
          </div>
          <div class="manifesto-card">
            <h3>Signals over lists</h3>
            <p class="subtle">We highlight movement: momentum, churn, and cross-listing.</p>
          </div>
          <div class="manifesto-card">
            <h3>Reusable trails</h3>
            <p class="subtle">Curated sequences for learning paths and team onboarding.</p>
          </div>
        </div>
      </div>
      <div class="card fade-in">
        <h3>Update cadence</h3>
        <p class="subtle">Harvest window: {build.harvest_window}</p>
        <ProvenancePanel provenance={build} />
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="section-head">
        <h2>Trending this snapshot</h2>
        <CoverageBadge value={Math.round((coverage.overall.coverage ?? 0) * 100)} />
      </div>
      <div class="grid">
        {trending.map((paper) => (
          <PaperCard paper={paper} />
        ))}
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container callout-grid">
      <div class="card callout">
        <h2>Causal AI Tendency Radar</h2>
        <p class="subtle">Explore momentum, cross-listing, and revision churn in one view.</p>
        <a class="button" href={withBase("/observatory")}>Open Observatory</a>
      </div>
      <div class="card">
        <h2>Start here</h2>
        <p class="subtle">Guided learning paths for new team members and busy practitioners.</p>
        <a class="button secondary" href={withBase("/learn")}>View learning paths</a>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="section-head">
        <h2>Topic momentum</h2>
        <p class="subtle">Week-over-week arXiv momentum from {windowA} vs {windowB}.</p>
      </div>
      <div class="momentum-grid">
        {topics.map((topic) => (
          <a class="card" href={withBase(`/topics/${topic.id}`)}>
            <h3>{topic.title}</h3>
            <p class="subtle">{topic.scope}</p>
            <div class="chip secondary">Momentum {momentum.topics[topic.id] ?? 0}</div>
          </a>
        ))}
      </div>
    </div>
  </section>

  <style>
    h1 {
      font-size: clamp(2.2rem, 4vw, 3.4rem);
      margin: 0 0 1rem;
    }

    .subtitle {
      font-size: 1.1rem;
      max-width: 48ch;
      color: var(--muted);
      line-height: 1.6;
    }

    .hero-grid {
      display: grid;
      gap: 2rem;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      align-items: center;
    }

    .hero-actions {
      display: flex;
      gap: 0.8rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }

    .manifesto {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      margin-top: 1.5rem;
    }

    .manifesto-card {
      padding: 0.9rem 1rem;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: var(--bg-elevated);
    }

    .section-head {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .grid {
      display: grid;
      gap: 1.5rem;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    }

    .callout-grid {
      display: grid;
      gap: 1.5rem;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }

    .callout {
      background: linear-gradient(120deg, color-mix(in srgb, var(--accent) 18%, transparent), transparent 70%);
    }

    .momentum-grid {
      display: grid;
      gap: 1.2rem;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }
  </style>
</BaseLayout>
